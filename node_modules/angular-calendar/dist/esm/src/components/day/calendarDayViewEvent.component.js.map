{"version":3,"file":"calendarDayViewEvent.component.js","sourceRoot":"","sources":["../../../../../src/components/day/calendarDayViewEvent.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, Output, EventEmitter, ChangeDetectorRef } from '@angular/core';\nimport { DayViewEvent } from 'calendar-utils';\nimport { ResizeEvent } from 'angular-resizable-element';\nimport addMinutes from 'date-fns/add_minutes';\nimport { CalendarDragHelper } from '../../providers/calendarDragHelper.provider';\nimport { CalendarResizeHelper } from '../../providers/calendarResizeHelper.provider';\n\n\nexport class CalendarDayViewEventComponent {\n\n   dayEvent: DayViewEvent;\n\n   hourSegments: number;\n\n   eventSnapSize: number;\n\n   tooltipPlacement: string;\n\n   dayViewContainer: HTMLElement;\n\n   eventClicked: EventEmitter<any> = new EventEmitter();\n\n   eventResized: EventEmitter<any> = new EventEmitter();\n\n  currentResize: {\n    originalTop: number,\n    originalHeight: number,\n    edge: string\n  };\n\n  validateDrag: Function;\n\n  validateResize: Function;\n\n  constructor(private cdr: ChangeDetectorRef) {}\n\n  resizeStarted(event: DayViewEvent, resizeEvent: ResizeEvent): void {\n    this.currentResize = {\n      originalTop: event.top,\n      originalHeight: event.height,\n      edge: typeof resizeEvent.edges.top !== 'undefined' ? 'top' : 'bottom'\n    };\n    const resizeHelper: CalendarResizeHelper = new CalendarResizeHelper(this.dayViewContainer);\n    this.validateResize = ({rectangle}) => resizeHelper.validateResize({rectangle});\n    this.cdr.markForCheck();\n  }\n\n  resizing(event: DayViewEvent, resizeEvent: ResizeEvent): void {\n    if (resizeEvent.edges.top) {\n      event.top = this.currentResize.originalTop + +resizeEvent.edges.top;\n      event.height = this.currentResize.originalHeight - +resizeEvent.edges.top;\n    } else if (resizeEvent.edges.bottom) {\n      event.height = this.currentResize.originalHeight + +resizeEvent.edges.bottom;\n    }\n  }\n\n  resizeEnded(dayEvent: DayViewEvent): void {\n\n    let segments: number;\n    if (this.currentResize.edge === 'top') {\n      segments = (dayEvent.top - this.currentResize.originalTop) / this.eventSnapSize;\n    } else {\n      segments = (dayEvent.height - this.currentResize.originalHeight) / this.eventSnapSize;\n    }\n\n    dayEvent.top = this.currentResize.originalTop;\n    dayEvent.height = this.currentResize.originalHeight;\n\n    const segmentAmountInMinutes: number = 60 / this.hourSegments;\n    const minutesMoved: number = segments * segmentAmountInMinutes;\n    let newStart: Date = dayEvent.event.start;\n    let newEnd: Date = dayEvent.event.end;\n    if (this.currentResize.edge === 'top') {\n      newStart = addMinutes(newStart, minutesMoved);\n    } else if (newEnd) {\n      newEnd = addMinutes(newEnd, minutesMoved);\n    }\n\n    this.eventResized.emit({newStart, newEnd, event: dayEvent.event});\n    this.currentResize = null;\n\n  }\n\n  dragStart(event: HTMLElement): void {\n    const dragHelper: CalendarDragHelper = new CalendarDragHelper(this.dayViewContainer, event);\n    this.validateDrag = ({x, y}) => dragHelper.validateDrag({x, y});\n    this.cdr.markForCheck();\n  }\n\n  eventDragged(dayEvent: DayViewEvent, draggedInPixels: number): void {\n    const segments: number = draggedInPixels / this.eventSnapSize;\n    const segmentAmountInMinutes: number = 60 / this.hourSegments;\n    const minutesMoved: number = segments * segmentAmountInMinutes;\n    const newStart: Date = addMinutes(dayEvent.event.start, minutesMoved);\n    let newEnd: Date;\n    if (dayEvent.event.end) {\n      newEnd = addMinutes(dayEvent.event.end, minutesMoved);\n    }\n    this.eventResized.emit({newStart, newEnd, event: dayEvent.event});\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'mwl-calendar-day-view-event',\n  template: `\n    <div\n      class=\"cal-event\"\n      #event\n      [style.marginTop.px]=\"dayEvent.top\"\n      [style.marginLeft.px]=\"dayEvent.left + 70\"\n      [style.height.px]=\"dayEvent.height\"\n      [style.width.px]=\"dayEvent.width - 1\"\n      [style.backgroundColor]=\"dayEvent.event.color.secondary\"\n      [style.borderColor]=\"dayEvent.event.color.primary\"\n      [class.cal-starts-within-day]=\"!dayEvent.startsBeforeDay\"\n      [class.cal-ends-within-day]=\"!dayEvent.endsAfterDay\"\n      [class.cal-draggable]=\"dayEvent.event.draggable\"\n      [ngClass]=\"dayEvent.event.cssClass\"\n      [mwlCalendarTooltip]=\"dayEvent.event.title | calendarEventTitle:'dayTooltip':dayEvent.event\"\n      [tooltipPlacement]=\"tooltipPlacement\"\n      mwlResizable\n      [resizeEdges]=\"{top: dayEvent.event?.resizable?.beforeStart, bottom: dayEvent.event?.resizable?.afterEnd}\"\n      [resizeSnapGrid]=\"{top: eventSnapSize, bottom: eventSnapSize}\"\n      [validateResize]=\"validateResize\"\n      (resizeStart)=\"resizeStarted(dayEvent, $event)\"\n      (resizing)=\"resizing(dayEvent, $event)\"\n      (resizeEnd)=\"resizeEnded(dayEvent)\"\n      mwlDraggable\n      [dragAxis]=\"{x: false, y: dayEvent.event.draggable && !currentResize}\"\n      [dragSnapGrid]=\"{y: eventSnapSize}\"\n      [validateDrag]=\"validateDrag\"\n      (dragStart)=\"dragStart(event)\"\n      (dragEnd)=\"eventDragged(dayEvent, $event.y)\">\n      <mwl-calendar-event-title\n        [event]=\"dayEvent.event\"\n        view=\"day\"\n        (click)=\"eventClicked.emit()\">\n      </mwl-calendar-event-title>\n      <mwl-calendar-event-actions [event]=\"dayEvent.event\"></mwl-calendar-event-actions>\n    </div>\n  `\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ChangeDetectorRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'dayEvent': [{ type: Input },],\n'hourSegments': [{ type: Input },],\n'eventSnapSize': [{ type: Input },],\n'tooltipPlacement': [{ type: Input },],\n'dayViewContainer': [{ type: Input },],\n'eventClicked': [{ type: Output },],\n'eventResized': [{ type: Output },],\n};\n}\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}