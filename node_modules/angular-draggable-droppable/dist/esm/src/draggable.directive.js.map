{"version":3,"file":"draggable.directive.js","sourceRoot":"","sources":["../../../src/draggable.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {Directive, HostListener, OnInit, ElementRef, Renderer, Output, EventEmitter, Input, OnDestroy} from '@angular/core';\nimport {Subject} from 'rxjs/Subject';\nimport {Observable} from 'rxjs/Observable';\nimport 'rxjs/add/observable/merge';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/mergeMap';\nimport 'rxjs/add/operator/takeUntil';\nimport 'rxjs/add/operator/take';\nimport 'rxjs/add/operator/takeLast';\nimport 'rxjs/add/operator/pairwise';\nimport 'rxjs/add/operator/share';\nimport {DraggableHelper} from './draggableHelper.provider';\n\nexport type Coordinates = {x: number, y: number};\n\nexport type DragAxis = {x: boolean, y: boolean};\n\nexport type SnapGrid = {x?: number, y?: number};\n\nexport type ValidateDrag = (coordinates: Coordinates) => boolean;\n\nconst MOVE_CURSOR: string = 'move';\n\n\nexport class Draggable implements OnInit, OnDestroy {\n\n   dropData: any;\n\n   dragAxis: DragAxis = {x: true, y: true};\n\n   dragSnapGrid: SnapGrid = {};\n\n   ghostDragEnabled: boolean = true;\n\n   validateDrag: ValidateDrag;\n\n   dragStart: EventEmitter<Coordinates> = new EventEmitter<Coordinates>();\n\n   dragging: EventEmitter<Coordinates> = new EventEmitter<Coordinates>();\n\n   dragEnd: EventEmitter<Coordinates> = new EventEmitter<Coordinates>();\n\n  public mouseDown: Subject<any> = new Subject();\n\n  public mouseMove: Subject<any> = new Subject();\n\n  public mouseUp: Subject<any> = new Subject();\n\n  constructor(public element: ElementRef, private renderer: Renderer, private draggableHelper: DraggableHelper) {}\n\n  ngOnInit(): void {\n\n    const mouseDrag: Observable<any> = this.mouseDown\n      .filter(() => this.canDrag())\n      .flatMap((mouseDownEvent: MouseEvent) => {\n\n        this.dragStart.next({x: 0, y: 0});\n        this.setCursor(MOVE_CURSOR);\n\n        const currentDrag: Subject<any> = new Subject();\n\n        this.draggableHelper.currentDrag.next(currentDrag);\n\n        const mouseMove: Observable<Coordinates> = this.mouseMove\n          .map((mouseMoveEvent: MouseEvent) => {\n\n            mouseMoveEvent.preventDefault();\n\n            return {\n              currentDrag,\n              x: mouseMoveEvent.clientX - mouseDownEvent.clientX,\n              y: mouseMoveEvent.clientY - mouseDownEvent.clientY,\n              clientX: mouseMoveEvent.clientX,\n              clientY: mouseMoveEvent.clientY\n            };\n\n          })\n          .map((moveData: Coordinates) => {\n\n            if (this.dragSnapGrid.x) {\n              moveData.x = Math.floor(moveData.x / this.dragSnapGrid.x) * this.dragSnapGrid.x;\n            }\n\n            if (this.dragSnapGrid.y) {\n              moveData.y = Math.floor(moveData.y / this.dragSnapGrid.y) * this.dragSnapGrid.y;\n            }\n\n            return moveData;\n          })\n          .map((moveData: Coordinates) => {\n\n            if (!this.dragAxis.x) {\n              moveData.x = 0;\n            }\n\n            if (!this.dragAxis.y) {\n              moveData.y = 0;\n            }\n\n            return moveData;\n          })\n          .filter(({x, y}) => !this.validateDrag || this.validateDrag({x, y}))\n          .takeUntil(Observable.merge(this.mouseUp, this.mouseDown));\n\n        mouseMove.takeLast(1).subscribe(({x, y}) => {\n          this.dragEnd.next({x, y});\n          currentDrag.complete();\n          this.setCssTransform(null);\n          if (this.ghostDragEnabled) {\n            this.renderer.setElementStyle(this.element.nativeElement, 'pointerEvents', null);\n          }\n        });\n\n        return mouseMove;\n\n      })\n      .share();\n\n    Observable\n      .merge(\n        mouseDrag.take(1).map(value => [, value]),\n        mouseDrag.pairwise()\n      )\n      .filter(([previous, next]) => {\n        if (!previous) {\n          return true;\n        }\n        return previous.x !== next.x || previous.y !== next.y;\n      })\n      .map(([previous, next]) => next)\n      .subscribe(({x, y, currentDrag, clientX, clientY}) => {\n        this.dragging.next({x, y});\n        if (this.ghostDragEnabled) {\n          this.renderer.setElementStyle(this.element.nativeElement, 'pointerEvents', 'none');\n        }\n        this.setCssTransform(`translate(${x}px, ${y}px)`);\n        currentDrag.next({\n          clientX,\n          clientY,\n          dropData: this.dropData\n        });\n      });\n\n  }\n\n  ngOnDestroy(): void {\n    this.mouseDown.complete();\n    this.mouseMove.complete();\n    this.mouseUp.complete();\n  }\n\n  /**\n   * @private\n   */\n  \n  onMouseDown(event: MouseEvent): void {\n    this.mouseDown.next(event);\n  }\n\n  /**\n   * @private\n   */\n  \n  onMouseMove(event: MouseEvent): void {\n    this.mouseMove.next(event);\n  }\n\n  /**\n   * @private\n   */\n  \n  onMouseUp(event: MouseEvent): void {\n    this.mouseUp.next(event);\n  }\n\n  /**\n   * @private\n   */\n  \n  onMouseEnter(): void {\n    if (this.canDrag()) {\n      this.setCursor(MOVE_CURSOR);\n    }\n  }\n\n  /**\n   * @private\n   */\n  \n  onMouseLeave(): void {\n    this.setCursor(null);\n  }\n\n  private setCssTransform(value: string): void {\n    if (this.ghostDragEnabled) {\n      this.renderer.setElementStyle(this.element.nativeElement, 'transform', value);\n      this.renderer.setElementStyle(this.element.nativeElement, '-webkit-transform', value);\n      this.renderer.setElementStyle(this.element.nativeElement, '-ms-transform', value);\n      this.renderer.setElementStyle(this.element.nativeElement, '-moz-transform', value);\n      this.renderer.setElementStyle(this.element.nativeElement, '-o-transform', value);\n    }\n  }\n\n  private canDrag(): boolean {\n    return this.dragAxis.x || this.dragAxis.y;\n  }\n\n  private setCursor(value: string): void {\n    this.renderer.setElementStyle(this.element.nativeElement, 'cursor', value);\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\n  selector: '[mwlDraggable]'\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: Renderer, },\n{type: DraggableHelper, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'dropData': [{ type: Input },],\n'dragAxis': [{ type: Input },],\n'dragSnapGrid': [{ type: Input },],\n'ghostDragEnabled': [{ type: Input },],\n'validateDrag': [{ type: Input },],\n'dragStart': [{ type: Output },],\n'dragging': [{ type: Output },],\n'dragEnd': [{ type: Output },],\n'onMouseDown': [{ type: HostListener, args: ['mousedown', ['$event'], ] },],\n'onMouseMove': [{ type: HostListener, args: ['document:mousemove', ['$event'], ] },],\n'onMouseUp': [{ type: HostListener, args: ['document:mouseup', ['$event'], ] },],\n'onMouseEnter': [{ type: HostListener, args: ['mouseenter', ] },],\n'onMouseLeave': [{ type: HostListener, args: ['mouseleave', ] },],\n};\n}\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}